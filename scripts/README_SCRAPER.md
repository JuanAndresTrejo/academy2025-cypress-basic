# 🕵️‍♂️ Sistema de Scraper Inteligente para Cypress

## 📋 Descripción

Este sistema permite **mapear automáticamente** todos los elementos de una página web y generar locators optimizados para usar en tests de Cypress. Funciona como un **scraper inteligente** que categoriza elementos y crea selectores robustos.

## 🎯 Características Principales

### ✅ **Exploración Automática**
- Escanea toda la página en busca de elementos interactivos
- Categoriza elementos por tipo (navegación, botones, inputs, etc.)
- Genera múltiples selectores por elemento (ID, clase, texto, etc.)
- Captura posición y atributos de cada elemento

### ✅ **Interceptación de Red**
- Monitorea requests HTTP durante la exploración
- Identifica APIs y recursos utilizados
- Genera reportes de actividad de red

### ✅ **Generación de Locators**
- Crea archivo JSON con locators optimizados
- Prioriza selectores más estables (ID > data-testid > clase)
- Incluye selectores alternativos para mayor robustez
- Genera ejemplos de uso automáticamente

## 📁 Estructura de Archivos

```
cypress/
├── e2e/
│   ├── features/
│   │   └── exploratory.feature          # Tests de exploración
│   └── step_definitions/
│       └── exploratorySteps.js          # Steps del scraper
├── fixtures/
│   └── discovered/                      # Archivos generados
│       ├── discovered-elements-*.json   # Elementos encontrados
│       ├── navigation-map.json          # Mapa de navegación
│       └── network-requests.json       # Requests interceptados
└── pages/
    └── locators/
        ├── AutoGeneratedLocators.json   # Locators optimizados
        └── UsageExample.js              # Ejemplos de uso

scripts/
├── unifiedScraperProcessor.js          # Script unificado principal
├── cypressTestGenerator.js             # Generador de pruebas completo
└── README.md                           # Documentación del sistema
```

## 🚀 Uso del Sistema

### **1. Ejecutar Exploración Completa**

```bash
# Ejecutar test exploratorio completo
npx cypress run --e2e --browser chrome --headed -s cypress/e2e/features/exploratory.feature
```

### **2. Generar Locators Optimizados**

```bash
# Procesar archivos descubiertos y generar locators
node scripts/unifiedScraperProcessor.js
```

### **3. Usar Locators en Tests**

```javascript
import locators from '../pages/locators/AutoGeneratedLocators.json';

// Navegación
cy.get(locators.navigation.shop.primary).click();
cy.get(locators.navigation.my_account.primary).click();

// Botones
cy.get(locators.buttons.login.primary).click();

// Inputs
cy.get(locators.inputs.username.primary).type('usuario');
cy.get(locators.inputs.password.primary).type('contraseña');

// Uso robusto con alternativas
function getElement(locatorObj) {
    const selectors = [locatorObj.primary, ...locatorObj.alternatives];
    for (const selector of selectors) {
        if (Cypress.$(selector).length > 0) {
            return cy.get(selector);
        }
    }
    throw new Error('Ningún selector funcionó');
}

getElement(locators.navigation.shop).click();
```

## 📊 Tipos de Elementos Detectados

### **🧭 Navegación**
- Menús principales y secundarios
- Enlaces de navegación
- Breadcrumbs

### **🔘 Botones**
- Botones de acción
- Botones de envío
- Botones interactivos

### **📝 Inputs**
- Campos de texto
- Campos de contraseña
- Selectores y textareas

### **🔗 Enlaces**
- Enlaces externos
- Enlaces internos
- Enlaces de descarga

### **📦 Contenedores**
- Headers y footers
- Secciones principales
- Contenedores de contenido

### **🖼️ Imágenes**
- Imágenes con alt text
- Imágenes interactivas
- Logos y banners

## 🔧 Configuración Avanzada

### **Tareas de Cypress Disponibles**

```javascript
// Crear directorio para archivos descubiertos
cy.task('ensureDir', 'cypress/fixtures/discovered');

// Encontrar archivo más reciente
cy.task('findLatestFile', 'cypress/fixtures/discovered/discovered-elements-*.json');

// Limpiar archivos antiguos
cy.task('cleanupDiscoveredFiles', 7); // 7 días

// Generar reporte HTML
cy.task('generateElementsReport');
```

### **Steps Disponibles**

```gherkin
# Exploración básica
When Extraigo elementos necesarios de los casos de prueba
When Mapeo la barra superior y navegación principal
Then Genero archivo de locators optimizados

# Monitoreo de red
When Intercepto y monitoreo requests de red durante la exploración
Then Verifico que se capturaron los requests correctamente

# Validaciones
Then Verifico que se encontraron elementos en todas las categorías
Then Verifico que los selectores generados son únicos
Then Verifico que los locators son válidos y utilizables
```

## 📈 Estadísticas de Ejemplo

```
🎉 Locators optimizados generados exitosamente!
📄 Archivo guardado en: ./cypress/pages/locators/AutoGeneratedLocators.json

📊 Estadísticas:
   • Total de locators: 39
   • Navegación: 16
   • Botones: 2
   • Inputs: 7
   • Enlaces: 9
   • Contenedores: 3
   • Imágenes: 2
   • Interactivos: 0
```

## 🎯 Beneficios

### **Para QA Automatizadores**
- ⚡ **Acelera** la creación de tests
- 🔍 **Descubre** elementos que podrían pasarse por alto
- 📝 **Documenta** automáticamente la estructura de la página
- 🛡️ **Mejora** la robustez con selectores alternativos

### **Para Desarrolladores**
- 📊 **Visibilidad** de elementos sin IDs o data-testids
- 🔧 **Identificación** de elementos difíciles de testear
- 📈 **Métricas** de complejidad de la interfaz

### **Para el Proyecto**
- 🚀 **Reduce** tiempo de desarrollo de tests
- 📚 **Mantiene** inventario actualizado de elementos
- 🔄 **Facilita** mantenimiento de tests
- 📋 **Estandariza** selectores en el proyecto

## 🔮 Casos de Uso

### **1. Exploración Inicial**
Cuando trabajas con una aplicación nueva y necesitas entender su estructura.

### **2. Auditoría de Elementos**
Para identificar elementos sin identificadores únicos.

### **3. Generación Masiva de Locators**
Cuando necesitas crear muchos tests rápidamente.

### **4. Documentación Automática**
Para mantener documentación actualizada de la interfaz.

### **5. Detección de Cambios**
Comparar exploraciones para detectar cambios en la UI.

## ⚠️ Consideraciones

- Los selectores generados son **genéricos** y pueden necesitar ajustes
- Es recomendable **revisar** los locators antes de usar en producción
- Los selectores por texto pueden **cambiar** con traducciones
- Algunos elementos dinámicos pueden **no ser detectados** correctamente

## 🔄 Flujo de Trabajo Recomendado

1. **Ejecutar exploración** en páginas clave
2. **Generar locators** optimizados
3. **Revisar y ajustar** selectores según necesidad
4. **Integrar** en tests existentes
5. **Repetir** periódicamente para detectar cambios
